<script>
        const firebaseConfig = { databaseURL: "https://cloudzinfo-1f0ec-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName = "", currentType = "", gameLoop, score = 0, keys = {}, active = false;
        let pX=200, pY=200, pDY=0, bullets=[], zoms=[], snake=[], sDir='R', food={}, obs=[], tagPlayers={};
        const canvas = document.getElementById('game-canvas'), ctx = canvas.getContext('2d');
        const cur = document.getElementById('cursor-wrapper');
        let rot = 0;

        // UI for Online Counter (Top Right)
        const onlineDisplay = document.createElement('div');
        onlineDisplay.style = "position:fixed; top:20px; right:20px; font-size:0.9rem; color:#0f0; z-index:2000; text-shadow:0 0 8px #0f0; font-weight:bold; letter-spacing:1px;";
        document.body.appendChild(onlineDisplay);

        window.addEventListener('mousemove', e => { cur.style.left = e.clientX + 'px'; cur.style.top = e.clientY + 'px'; });
        setInterval(() => { rot += 1.5; cur.style.transform = `translate(-50%,-50%) rotate(${rot}deg)`; }, 16);

        window.onload = () => {
            const savedU = localStorage.getItem('c_user');
            const savedP = localStorage.getItem('c_pass');
            if (savedU && savedP) {
                document.getElementById('username').value = savedU;
                document.getElementById('password').value = savedP;
            }
        };

        function startSystem() {
            document.getElementById('intro-overlay').style.display='none';
            document.getElementById('auth-modal').style.display='block';
            document.getElementById('bg-music').play().catch(()=>{});
        }

        function login() {
            myName = document.getElementById('username').value.trim();
            let myPass = document.getElementById('password').value;
            if(!myName) return;
            
            if(document.getElementById('rememberMe').checked) {
                localStorage.setItem('c_user', myName);
                localStorage.setItem('c_pass', myPass);
            } else {
                localStorage.removeItem('c_user');
                localStorage.removeItem('c_pass');
            }

            // --- ONLINE COUNTING LOGIC ---
            // Create a unique entry for this session
            const userRef = db.ref('online/' + myName);
            userRef.set(true); // Just set to true, no data needed
            userRef.onDisconnect().remove(); // Auto-remove when tab closes

            // Listen for changes in the 'online' node
            db.ref('online').on('value', snapshot => {
                const count = snapshot.numChildren(); // Just get the total number
                onlineDisplay.innerHTML = `LIVE: ${count} USERS`;
            });

            document.getElementById('auth-modal').style.display='none';
            document.getElementById('main-content').style.display='flex';
            document.getElementById('controls').style.display='flex';
            
            db.ref('chat').limitToLast(20).on('child_added', s => {
                const h = document.getElementById('chat-history'); const v = s.val();
                h.innerHTML += `<div><span style="color:hsl(${v.u.length*30},70%,70%)">${v.u}:</span> ${v.t}</div>`;
                h.scrollTop = h.scrollHeight;
            });
        }

        function copyDiscord() {
            const btn = document.getElementById('btn-discord');
            navigator.clipboard.writeText("hellothere.33");
            btn.innerText = "COPIED";
            setTimeout(() => { btn.innerText = "DISCORD: hellothere.33"; }, 2000);
        }

        function toggleChat() { let c=document.getElementById('chat-window'); c.style.display=(c.style.display==='flex'?'none':'flex'); }
        document.getElementById('chat-input').onkeydown = e => { if(e.key==='Enter' && e.target.value.trim()){ db.ref('chat').push({u:myName, t:e.target.value}); e.target.value=""; }};

        // ... (Remaining Game Logic) ...
        function handleGameClick(e) { if(currentType === 'zombies' && active) { let rect = canvas.getBoundingClientRect(); let angle = Math.atan2((e.clientY-rect.top)-(pY+10), (e.clientX-rect.left)-(pX+10)); bullets.push({x:pX+10, y:pY+10, dx:Math.cos(angle)*7, dy:Math.sin(angle)*7}); } }
        window.onkeydown = e => { keys[e.code] = true; if(currentType === 'snake') { if((e.code==='KeyW'||e.code==='ArrowUp') && sDir!=='D') sDir='U'; if((e.code==='KeyS'||e.code==='ArrowDown') && sDir!=='U') sDir='D'; if((e.code==='KeyA'||e.code==='ArrowLeft') && sDir!=='R') sDir='L'; if((e.code==='KeyD'||e.code==='ArrowRight') && sDir!=='L') sDir='R'; } };
        window.onkeyup = e => keys[e.code] = false;
        function launchGame(t) { currentType = t; active = true; score = 0; document.getElementById('games-hub').style.display='none'; document.getElementById('play-area').style.display='block'; canvas.style.display = 'block'; document.getElementById('retry-btn').style.display='none'; document.getElementById('g-name').textContent = t.toUpperCase(); document.getElementById('g-score').innerText = "0"; if(gameLoop) clearInterval(gameLoop); if(t==='snake') { snake=[{x:10,y:10},{x:9,y:10}]; sDir='R'; food={x:15,y:10}; gameLoop=setInterval(doSnake, 100); } if(t==='dino') { pY=350; pDY=0; obs=[]; gameLoop=setInterval(doDino, 20); } if(t==='zombies') { pX=200; pY=200; zoms=[]; bullets=[]; gameLoop=setInterval(doZoms, 20); } if(t==='tag') { db.ref('online').on('value', s => tagPlayers = s.val() || {}); gameLoop=setInterval(doTag, 20); } }
        function doSnake() { let head = {...snake[0]}; if(sDir==='U') head.y--; if(sDir==='D') head.y++; if(sDir==='L') head.x--; if(sDir==='R') head.x++; if(head.x<0||head.x>=20||head.y<0||head.y>=20||snake.some(s=>s.x===head.x&&s.y===head.y)) return end(); snake.unshift(head); if(head.x===food.x && head.y===food.y) { score++; food={x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*20)}; document.getElementById('g-score').innerText=score; } else snake.pop(); ctx.fillStyle="#000"; ctx.fillRect(0,0,400,400); ctx.fillStyle="#0f0"; snake.forEach(s=>ctx.fillRect(s.x*20,s.y*20,18,18)); ctx.fillStyle="#f00"; ctx.fillRect(food.x*20,food.y*20,18,18); }
        function doDino() { pDY+=1; pY+=pDY; if(pY>350){ pY=350; pDY=0; } if(keys['Space'] && pY===350) pDY=-15; if(Math.random()<0.02) obs.push({x:400, w:20, h:30}); ctx.fillStyle="#000"; ctx.fillRect(0,0,400,400); ctx.fillStyle="#fff"; ctx.fillRect(50,pY,30,30); obs.forEach((o,i)=>{ o.x-=5; ctx.fillRect(o.x,400-o.h,o.w,o.h); if(o.x<80&&o.x>20&&pY>370-o.h) end(); }); }
        function doZoms() { if(keys['KeyW']) pY-=3; if(keys['KeyS']) pY+=3; if(keys['KeyA']) pX-=3; if(keys['KeyD']) pX+=3; if(Math.random()<0.03) { let edge = Math.floor(Math.random()*4); let zX, zY; if(edge===0){zX=Math.random()*400; zY=-20;} else if(edge===1){zX=420; zY=Math.random()*400;} else if(edge===2){zX=Math.random()*400; zY=420;} else {zX=-20; zY=Math.random()*400;} zoms.push({x:zX, y:zY}); } ctx.fillStyle="#000"; ctx.fillRect(0,0,400,400); ctx.fillStyle="#00f"; ctx.fillRect(pX,pY,20,20); bullets.forEach((b,i)=>{ b.x+=b.dx; b.y+=b.dy; ctx.fillStyle="#fff"; ctx.fillRect(b.x-2,b.y-2,4,4); if(b.x<0||b.x>400||b.y<0||b.y>400) bullets.splice(i,1); }); zoms.forEach((z,zi)=>{ let dx=pX-z.x, dy=pY-z.y, dist=Math.hypot(dx,dy); z.x+=dx/dist*1.5; z.y+=dy/dist*1.5; ctx.fillStyle="#0f0"; ctx.fillRect(z.x-8,z.y-8,16,16); if(dist<15) end(); bullets.forEach((b,bi)=>{ if(Math.hypot(b.x-z.x, b.y-z.y)<15){ zoms.splice(zi,1); bullets.splice(bi,1); score++; document.getElementById('g-score').innerText=score; }}); }); }
        function doTag() { ctx.fillStyle="#000"; ctx.fillRect(0,0,400,400); if(keys['KeyW']) pY-=4; if(keys['KeyS']) pY+=4; if(keys['KeyA']) pX-=4; if(keys['KeyD']) pX+=4; db.ref('online/'+myName).update({x:pX, y:pY}); Object.keys(tagPlayers).forEach(id => { let p = tagPlayers[id]; ctx.fillStyle = p.it ? "red" : "white"; ctx.fillRect(p.x-8, p.y-8, 16, 16); }); }
        function end() { active=false; clearInterval(gameLoop); document.getElementById('retry-btn').style.display='block'; }
        function retryGame() { launchGame(currentType); }
        function quitGame() { clearInterval(gameLoop); active=false; document.getElementById('play-area').style.display='none'; document.getElementById('main-content').style.display='flex'; }

        particlesJS("particles-js", { 
            "particles": { 
                "number": { "value": 160, "density": { "enable": true, "value_area": 800 } }, 
                "size": { "value": 1.2 }, 
                "line_linked": { "enable": true, "distance": 130, "opacity": 0.2 }, 
                "move": { "enable": true, "speed": 0.5 } 
            },
            "interactivity": { "events": { "onhover": { "enable": true, "mode": "grab" } } }
        });
    </script>
