<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CLOUDZ!!!!</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; cursor: none !important; }
        body { background: #000; color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center; }
        #particles-js { position: absolute; inset: 0; z-index: 1; }
        
        /* CURSOR */
        #cursor-wrapper { position: fixed; pointer-events: none; z-index: 999999; transform: translate(-50%, -50%); mix-blend-mode: difference; }
        .reticle { width: 30px; height: 30px; border: 2px solid #fff; position: absolute; transform: translate(-50%, -50%); animation: rot 4s linear infinite; }
        @keyframes rot { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* MODALS & UI */
        .modal-box { display: none; position: relative; z-index: 5000; width: 450px; padding: 40px; border: 2px solid #fff; background: rgba(0,0,0,0.95); text-align: center; }
        .btn-style { width: 100%; padding: 16px; border: 2px solid #fff; background: transparent; color: #fff; letter-spacing: 5px; margin: 10px 0; transition: 0.1s; text-transform: uppercase; font-weight: bold; }
        .btn-style:hover { background: #fff; color: #000; }
        input { width: 100%; padding: 15px; background: #000; border: 1px solid #fff; color: #fff; margin-bottom: 10px; text-align: center; font-size: 1rem; }
        
        .title { font-size: 80px; letter-spacing: 20px; text-transform: uppercase; margin-bottom: 20px; text-shadow: 0 0 15px #fff; }
        #debug-log { font-family: monospace; font-size: 10px; color: #ff4444; margin-top: 10px; text-transform: uppercase; }

        /* GAMES */
        #game-canvas { background: #000; border: 2px solid #fff; display: block; margin: 10px auto; }
        #g-status { letter-spacing: 3px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="particles-js"></div>
<div id="cursor-wrapper"><div class="reticle"></div></div>

<div id="intro-screen" style="z-index:9000; position:fixed; inset:0; background:#000; display:flex; justify-content:center; align-items:center;">
    <button class="btn-style" style="width:250px" onclick="startSystem()">ENTER CLOUDZ</button>
</div>

<div id="login-modal" class="modal-box" style="display:block;">
    <h2 style="letter-spacing:10px; margin-bottom:20px;">SECURITY</h2>
    <input type="text" id="u-name" placeholder="USERNAME">
    <input type="password" id="u-pass" placeholder="PASSWORD">
    <button class="btn-style" onclick="attemptLogin()">ACCESS</button>
    <div id="debug-log">SYSTEM READY</div>
</div>

<div id="main-menu" class="modal-box" style="border:none; background:transparent;">
    <h1 class="title">CLOUDZ</h1>
    <button class="btn-style" style="color:#5865F2; border-color:#5865F2;">DISCORD: CLOUDZ.CLOUD</button>
    <button class="btn-style" onclick="openMenu('games-hub')">GAMES</button>
    <button class="btn-style" onclick="location.reload()">LOGOUT</button>
</div>

<div id="games-hub" class="modal-box">
    <button class="btn-style" onclick="play('snake')">SNAKE</button>
    <button class="btn-style" onclick="play('zombies')">ZOMBIES</button>
    <button class="btn-style" onclick="openMenu('ttt-select')">TIC-TAC-TOE</button>
    <button class="btn-style" onclick="openMenu('main-menu')">BACK</button>
</div>

<div id="ttt-select" class="modal-box">
    <button class="btn-style" onclick="play('ttt-bot')">VS BOT</button>
    <button class="btn-style" onclick="play('ttt-friend')">LOCAL FRIEND</button>
    <button class="btn-style" onclick="play('ttt-online')">ONLINE PVP</button>
    <button class="btn-style" onclick="openMenu('games-hub')">BACK</button>
</div>

<div id="play-area" class="modal-box" style="width: auto;">
    <h3 id="g-status">READY</h3>
    <canvas id="game-canvas" width="400" height="400"></canvas>
    <button id="retry-btn" class="btn-style" style="display:none;" onclick="play(currentG)">RETRY</button>
    <button class="btn-style" onclick="openMenu('games-hub'); stopG();">QUIT</button>
</div>

<audio id="bg-m" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>

<script>
    const firebaseConfig = { databaseURL: "https://cloudzinfo-1f0ec-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myUser = "", currentG = "", loop, keys = {};
    window.onkeydown = e => keys[e.code] = true;
    window.onkeyup = e => keys[e.code] = false;

    function startSystem() {
        document.getElementById('intro-screen').style.display = 'none';
        document.getElementById('bg-m').play().catch(()=>{});
        particlesJS("particles-js", {"particles":{"number":{"value":40},"color":{"value":"#fff"},"size":{"value":2},"move":{"speed":1}}});
    }

    function attemptLogin() {
        const u = document.getElementById('u-name').value.trim().toUpperCase();
        const p = document.getElementById('u-pass').value;
        const logger = document.getElementById('debug-log');

        if(!u || !p) { logger.innerText = "ERROR: FIELDS EMPTY"; return; }

        logger.innerText = "SEARCHING DATABASE...";

        db.ref('users/' + u).once('value').then(snap => {
            const data = snap.val();
            
            if (!data) {
                logger.innerText = `ERROR: USER "${u}" NOT FOUND`;
                return;
            }

            // Using String() wrapper ensures '1234' matches 1234
            if (String(data.pass) === String(p)) {
                myUser = u;
                openMenu('main-menu');
            } else {
                logger.innerText = "ERROR: WRONG PASSWORD";
            }
        }).catch(e => {
            logger.innerText = "DB ERROR: CHECK FIREBASE RULES (READ=TRUE)";
        });
    }

    function openMenu(id) {
        document.querySelectorAll('.modal-box').forEach(m => m.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function stopG() { clearInterval(loop); }

    /* --- MINI GAMES ENGINE --- */
    const cv = document.getElementById('game-canvas'), cx = cv.getContext('2d');

    function play(type) {
        currentG = type;
        openMenu('play-area');
        stopG();
        document.getElementById('retry-btn').style.display = 'none';
        if(type === 'snake') runSnake();
        if(type === 'zombies') runZombies();
        if(type.includes('ttt')) runTTT(type);
    }

    function runZombies() {
        let px=200, py=200, z=[], b=[], sc=0;
        loop = setInterval(() => {
            if(keys['KeyW']) py-=5; if(keys['KeyS']) py+=5; if(keys['KeyA']) px-=5; if(keys['KeyD']) px+=5;
            if(keys['Space']) { b.push({x:px, y:py}); keys['Space']=false; }
            if(Math.random() < 0.04) z.push({x:Math.random()*400, y:0});
            cx.clearRect(0,0,400,400); cx.fillStyle="#fff"; cx.fillRect(px-10, py-10, 20, 20);
            b.forEach((bul, i) => { 
                bul.y -= 8; cx.fillStyle="yellow"; cx.fillRect(bul.x-2, bul.y, 4, 10);
                if(bul.y < 0) b.splice(i,1);
            });
            z.forEach((zm, i) => {
                let a = Math.atan2(py-zm.y, px-zm.x); zm.x += Math.cos(a)*2; zm.y += Math.sin(a)*2;
                cx.fillStyle="red"; cx.fillRect(zm.x-8, zm.y-8, 16, 16);
                b.forEach((bul, bi) => {
                    if(Math.hypot(zm.x-bul.x, zm.y-bul.y) < 15) { z.splice(i,1); b.splice(bi,1); sc+=10; }
                });
                if(Math.hypot(px-zm.x, py-zm.y) < 15) { stopG(); document.getElementById('retry-btn').style.display='block'; }
            });
            document.getElementById('g-status').innerText = "KILLS: " + sc;
        }, 20);
    }

    function runSnake() {
        let s=[{x:10,y:10}], d={x:1,y:0}, f={x:15,y:15}, sc=0;
        loop = setInterval(() => {
            if(keys['KeyW']&&d.y==0)d={x:0,y:-1}; if(keys['KeyS']&&d.y==0)d={x:0,y:1};
            if(keys['KeyA']&&d.x==0)d={x:-1,y:0}; if(keys['KeyD']&&d.x==0)d={x:1,y:0};
            let h={x:s[0].x+d.x, y:s[0].y+d.y};
            if(h.x<0||h.x>=20||h.y<0||h.y>=20) { stopG(); document.getElementById('retry-btn').style.display='block'; return; }
            s.unshift(h);
            if(h.x==f.x && h.y==f.y) { sc++; f={x:Math.floor(Math.random()*20), y:Math.floor(Math.random()*20)}; } else s.pop();
            cx.clearRect(0,0,400,400); cx.fillStyle="red"; cx.fillRect(f.x*20, f.y*20, 18, 18);
            cx.fillStyle="#fff"; s.forEach(p => cx.fillRect(p.x*20, p.y*20, 18, 18));
            document.getElementById('g-status').innerText = "SCORE: " + sc;
        }, 100);
    }

    // TTT Setup
    let tB = ["","","","","","","","",""], tP = "X";
    function runTTT(m) {
        tB = ["","","","","","","","",""]; tP = "X"; drawT();
        if(m === 'ttt-online') db.ref('ttt').on('value', s => { const v=s.val(); if(v){tB=v.b; tP=v.p; drawT(); checkT();} });
        cv.onclick = e => {
            let r = cv.getBoundingClientRect(), x = Math.floor((e.clientX-r.left)/133), y = Math.floor((e.clientY-r.top)/133), i = y*3+x;
            if(tB[i] === "") {
                tB[i] = tP; tP = tP === "X" ? "O" : "X";
                if(m === 'ttt-online') db.ref('ttt').set({b:tB, p:tP});
                else { drawT(); if(!checkT() && m === 'ttt-bot') botT(); }
            }
        };
    }
    function drawT() {
        cx.clearRect(0,0,400,400); cx.strokeStyle="#fff"; cx.lineWidth=2;
        for(let i=1; i<3; i++) { cx.strokeRect(i*133,0,0,400); cx.strokeRect(0,i*133,400,0); }
        cx.font="60px Arial"; cx.fillStyle="#fff";
        tB.forEach((v,i) => { if(v) cx.fillText(v, (i%3)*133+45, Math.floor(i/3)*133+85); });
    }
    function checkT() {
        const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        for(let s of w) if(tB[s[0]] && tB[s[0]]==tB[s[1]] && tB[s[0]]==tB[s[2]]) { alert(tB[s[0]]+" WINS"); play(currentG); return true; }
        if(!tB.includes("")) { alert("DRAW"); play(currentG); return true; }
        return false;
    }
    function botT() {
        let e = tB.map((v,i) => v===""?i:null).filter(v=>v!==null);
        if(e.length) { tB[e[Math.floor(Math.random()*e.length)]] = "O"; tP = "X"; drawT(); checkT(); }
    }

    window.onmousemove = e => {
        document.getElementById('cursor-wrapper').style.left = e.clientX + 'px';
        document.getElementById('cursor-wrapper').style.top = e.clientY + 'px';
    };
</script>
</body>
</html>
